<!DOCTYPE html >
<html>
   <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
    <title>Tweet Trends</title>
    <style>
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map {
        height: 50%;

      }
      #markerMap{
      	height: 50%;
      }
      /* Optional: Makes the sample page fill the window. */
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;

      }
      h1{
              text-shadow: 2px 2px 2px #FFFFFF;
      }

      form {
      	  color: white;
      	  padding: 10px;

  	  }	
  	  button{
  	  	padding: 10px;
  	  }


      #floating-panel {
        position: relative;
        top: 10px;
        left: 25%;
        z-index: 5;
        background-color: #fff;
        padding: 5px;
        border: 1px solid #999;
        text-align: center;
        font-family: 'Roboto','sans-serif';
        line-height: 30px;
        padding-left: 10px;
      }
      
      #floating-panel {
        background-color: #fff;
        border: 1px solid #999;
        left: 0%;
        padding: 5px;
        position: bottom;
        z-index: 5;


      }

	  .show {display: block;}
    </style>
  </head>

  <body style = "background-color:black;">
<h1 style="color:skyblue;text-align:center;font-size:50px;">
	#TweetTrends
</h1>
  <p style="color:skyblue;text-align:center;">
    This site is used to track where #MeToo tweets are occurring. It displays both a heatmap and a marker map, which you can edit in the forms below.
    To look at corresponding hashtags related to #MeToo, simply hover the cursor over a marker and it will be displayed
  </p>
  <div style="display: flex;">    
	<form>
    	Select two dates to show tweets in between the two.
    </form>
    <form>
    		From: 
    </form>
	 <form>
	  Month
	  <select id="selectMonth">
	    <option value="0">January</option>
	    <option value="1">February</option>
	    <option value="2">March</option>
	    <option value="3">April</option>
	    <option value="4">May</option>
	    <option value="5">June</option>
	    <option value="6">July</option>
	    <option value="7">August</option>
	    <option value="8">September</option>
	    <option value="9">October</option>
	    <option value="10">November</option>
	    <option value="11">Decenmber</option>
	  </select>
	</form>
	
	<form>
	  Day
	  <select id="selectDay">
	    <option value="1">1</option>
	    <option value="2">2</option>
	    <option value="3">3</option>
	    <option value="4">4</option>
	    <option value="5">5</option>
	    <option value="6">6</option>
	    <option value="7">7</option>
	    <option value="8">8</option>
	    <option value="9">9</option>
	    <option value="10">10</option>
	    <option value="11">11</option>
	    <option value="12">12</option>
	    <option value="13">13</option>
	    <option value="14">14</option>
	    <option value="15">15</option>
	    <option value="16">16</option>
	    <option value="17">17</option>
	    <option value="18">18</option>
	    <option value="19">19</option>
	    <option value="20">20</option>
	    <option value="21">21</option>
	    <option value="22">22</option>
	    <option value="23">23</option>
	    <option value="24">24</option>
	    <option value="25">25</option>
	    <option value="26">26</option>
	    <option value="27">27</option>
	    <option value="28">28</option>
	    <option value="29">29</option>
	    <option value="30">30</option>
	    <option value="31">31</option>
	  </select>
	</form>
	<form>
		Year
		<select id = "selectYear">
			<option value="2019">2019</option>
	    	<option value="2018">2018</option>
	    	<option value="2017">2017</option>
	    </select>
	</form>
    
    <form>
    		To: 
    </form>

	<form>
	  Month
	  <select id="selectSecondMonth">
	    <option value="0">January</option>
	    <option value="1">February</option>
	    <option value="2">March</option>
	    <option value="3">April</option>
	    <option value="4">May</option>
	    <option value="5">June</option>
	    <option value="6">July</option>
	    <option value="7">August</option>
	    <option value="8">September</option>
	    <option value="9">October</option>
	    <option value="10">November</option>
	    <option value="11">December</option>
	  </select>
	</form>
	

	<form>
	  Day
	  <select id="selectSecondDay">
	    <option value="1">1</option>
	    <option value="2">2</option>
	    <option value="3">3</option>
	    <option value="4">4</option>
	    <option value="5">5</option>
	    <option value="6">6</option>
	    <option value="7">7</option>
	    <option value="8">8</option>
	    <option value="9">9</option>
	    <option value="10">10</option>
	    <option value="11">11</option>
	    <option value="12">12</option>
	    <option value="13">13</option>
	    <option value="14">14</option>
	    <option value="15">15</option>
	    <option value="16">16</option>
	    <option value="17">17</option>
	    <option value="18">18</option>
	    <option value="19">19</option>
	    <option value="20">20</option>
	    <option value="21">21</option>
	    <option value="22">22</option>
	    <option value="23">23</option>
	    <option value="24">24</option>
	    <option value="25">25</option>
	    <option value="26">26</option>
	    <option value="27">27</option>
	    <option value="28">28</option>
	    <option value="29">29</option>
	    <option value="30">30</option>
	    <option value="31">31</option>
	  </select>
	</form>

	<form>
		Year
		<select id = "selectSecondYear">
			<option value="2019">2019</option>
	    	<option value="2018">2018</option>
	    	<option value="2017">2017</option>
	    </select>
	</form>

	<form>
		Tweet
		<select>
			<option value = "MeToo"> MeToo </option>
		</select>
	</form>

	<div style="text-align: center;">
		<button type="button" onclick="getInput()">Display</button>
	</div>

</div>


  <div id= "markerMap"></div>

   <div id="map"></div>

   <div id="floating-panel">
      <button onclick="toggleHeatmap()">Toggle Heatmap</button>
      <button onclick="changeGradient()">Change gradient</button>
      <button onclick="changeRadius()">Change radius</button>
      <button onclick="changeOpacity()">Change opacity</button>
    </div>

<p style="color:skyblue;text-align:center;">
  This website was created by the Monmouth University Software Engineering department, graduating class of 2019, made by: 
</p>

<p style="color:skyblue;text-align:center;padding:10px;">
  John Neppel
</p>
<p style="color:skyblue;text-align:center;padding:10px;">
  Thomas McHugh
</p>

<script>
var heatmap;
var heatMapData;
var markerData;
var map;
var markerMap;
var xml;

function initMap() {
var customGradient = [
      'rgba(0, 255, 255, 0)',
      'rgba(0, 255, 255, 1)',
      'rgba(0, 191, 255, 1)',
      'rgba(0, 127, 255, 1)',
      'rgba(0, 63, 255, 1)',
      'rgba(0, 0, 255, 1)',
      'rgba(0, 0, 223, 1)',
      'rgba(0, 0, 191, 1)',
      'rgba(0, 0, 159, 1)',
      'rgba(0, 0, 127, 1)',
      'rgba(63, 0, 91, 1)',
      'rgba(127, 0, 63, 1)',
      'rgba(191, 0, 31, 1)',
      'rgba(255, 0, 0, 1)'
    ]
 //creates basemap in the html container
    map = new google.maps.Map(document.getElementById('map'), {
    center: new google.maps.LatLng(40, -95),
    zoom: 4,
    styles: [
            {elementType: 'geometry', stylers: [{color: '#939393'}]},
            {
              featureType: 'road',
              elementType: 'geometry',
              stylers: [{color: '#696969'}]
            },
            {
              featureType: 'road',
              elementType: 'geometry.stroke',
              stylers: [{color: '#696969'}]
            },
            {
              featureType: 'road.highway',
              elementType: 'geometry',
              stylers: [{color: '#696969'}]
            },
            {
              featureType: 'road.highway',
              elementType: 'geometry.stroke',
              stylers: [{color: '#696969'}]
            },
            {
              featureType: 'transit',
              elementType: 'geometry',
              stylers: [{color: '#2f3948'}]
            },
            {
              featureType: 'water',
              elementType: 'geometry',
              stylers: [{color: '#000000'}]
            },
          ]
    });


    
    heatMapData = []; //will store coordinate points for heatmap data
    markerData = [];
    var image = "https://maps.google.com/mapfiles/ms/icons/blue-dot.png";
    var infoWindow = new google.maps.InfoWindow;


    //var xml;
    // Change this depending on the name of your PHP or XML file
    downloadUrl('https://tweettrends.csse-projects.monmouth.edu/metootest.xml', function(data) {
      
      
    	var today = new Date();
		today.setDate(today.getDate());

		var oneWeekAgo = new Date();
		oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);

      xml = data.responseXML;

      if(xml==null) {
      	alert('ITS NOT INITIALIZED');
   		}
    
      var products = xml.getElementsByTagName('Product');
      var size=products.length; //the total number of product nodes within file

      //The for loop will iterate through all of the 'Product' nodes,
      // extract the lat and long, then add it to the array of heatmap elements.
      for(i=0; i<size;i++) {

      	var latitude = parseFloat(products[i].getAttribute('latitude'));
      	var longitude = parseFloat(products[i].getAttribute('longitude'));
      	var date = new Date(products[i].getAttribute('tweet_timestamp'));
      	var hashtag = products[i].getAttribute('Hashtags');

      	if(date > oneWeekAgo && date < today){
	      	var marker = new google.maps.Marker({
	          position: new google.maps.LatLng(latitude, longitude),
	          visible: true,
	          icon: image,
	          map: markerMap,
	          title: hashtag
	        });


	      	markerData.push(marker);
	      	heatMapData.push(new google.maps.LatLng(latitude, longitude));
      	}
      } //end of for loop

      heatmap = new google.maps.visualization.HeatmapLayer({  
          data: heatMapData,
          map: map,
          opacity: 1,
          radius: 2.5,
          dissipating: false,
          gradient: customGradient
        });

    }); //end of downloadUrl

    markerMap = new google.maps.Map(document.getElementById('markerMap'), {
    center: new google.maps.LatLng(40, -95),
    zoom: 4,
    styles: [
            {elementType: 'geometry', stylers: [{color: '#939393'}]},
            {
              featureType: 'road',
              elementType: 'geometry',
              stylers: [{color: '#696969'}]
            },
            {
              featureType: 'road',
              elementType: 'geometry.stroke',
              stylers: [{color: '#696969'}]
            },
            {
              featureType: 'road.highway',
              elementType: 'geometry',
              stylers: [{color: '#696969'}]
            },
            {
              featureType: 'road.highway',
              elementType: 'geometry.stroke',
              stylers: [{color: '#696969'}]
            },
            {
              featureType: 'transit',
              elementType: 'geometry',
              stylers: [{color: '#2f3948'}]
            },
            {
              featureType: 'water',
              elementType: 'geometry',
              stylers: [{color: '#000000'}]
            },
          ]
    });
   } //end of initMap


function toggleHeatmap() {
    heatmap.setMap(heatmap.getMap() ? null : map);
  }

function changeGradient() {
    var customGradient = [
      'rgba(0, 255, 255, 0)',
      'rgba(0, 255, 255, 1)',
      'rgba(0, 191, 255, 1)',
      'rgba(0, 127, 255, 1)',
      'rgba(0, 63, 255, 1)',
      'rgba(0, 0, 255, 1)',
      'rgba(0, 0, 223, 1)',
      'rgba(0, 0, 191, 1)',
      'rgba(0, 0, 159, 1)',
      'rgba(0, 0, 127, 1)',
      'rgba(63, 0, 91, 1)',
      'rgba(127, 0, 63, 1)',
      'rgba(191, 0, 31, 1)',
      'rgba(255, 0, 0, 1)'
    ]
    heatmap.set('gradient', heatmap.get('gradient') ? null : customGradient);
  }

function changeRadius() {
    heatmap.set('radius', heatmap.get('radius') ? null : 1);
  }

function changeOpacity() {
    heatmap.set('opacity', heatmap.get('opacity') ? null : 1);
  }
     
     
     
function createHeatMapLayer(heatMapData) {
    heatmap = new google.maps.visualization.HeatmapLayer({ //creates a heatmap layer on top of the basemap
       data: heatMapData,
       map: map
     });
}
     
function downloadUrl(url, callback) {
    var request = window.ActiveXObject ?
        new ActiveXObject('Microsoft.XMLHTTP') :
        new XMLHttpRequest;

    request.onreadystatechange = function() {
      if (request.readyState == 4) {
        request.onreadystatechange = doNothing;
        callback(request, request.status);
      }
    };

    request.open('GET', url, true);
    request.send(null);
  }

function doNothing() {}

function myFunction() {
  document.getElementById("myDropdown").classList.toggle("show");
}

function removeMarkers(){
    var empty = [];
    for (var i = 0; i < markerData.length; i++) {
          markerData[i].setMap(null);
    }
    heatmap.setData(empty);
    heatMapData = [];
    markerData = [];
}

function getInput(){

	removeMarkers();
	var newDataSet = []
	var image = "https://maps.google.com/mapfiles/ms/icons/blue-dot.png";

	var month = document.getElementById("selectMonth").value;
	var day = document.getElementById("selectDay").value;
	var year = document.getElementById("selectYear").value;


	var secondMonth = document.getElementById("selectSecondMonth").value;
	var secondDay = document.getElementById("selectSecondDay").value;
	var secondYear = document.getElementById("selectSecondYear").value;

	var beforeDate = new Date(year, month, day);
	var afterDate = new Date(secondYear, secondMonth, secondDay);
   
    var products = xml.getElementsByTagName('Product');
    var size=products.length; //the total number of product nodes within file\

    for(i=0; i<size;i++) {

      var date = new Date(products[i].getAttribute('tweet_timestamp'));
      var hashtag = products[i].getAttribute('Hashtags');


      if(afterDate > beforeDate && date < afterDate && date > beforeDate){
        var latitude = parseFloat(products[i].getAttribute('latitude'));
       	var longitude = parseFloat(products[i].getAttribute('longitude'));

     	newDataSet.push(new google.maps.LatLng(latitude, longitude));

     	var marker = new google.maps.Marker({
          position: new google.maps.LatLng(latitude, longitude),
          visible: true,
          icon: image,
          map: markerMap,
          title: hashtag
        });
      	markerData.push(marker);
      }

    }//end of for loop

    heatmap.setData(newDataSet);

}

// Close the dropdown if the user clicks outside of it
window.onclick = function(event) {
  if (!event.target.matches('.dropbtn')) {
    var dropdowns = document.getElementsByClassName("dropdown-content");
    var i;
    for (i = 0; i < dropdowns.length; i++) {
      var openDropdown = dropdowns[i];
      if (openDropdown.classList.contains('show')) {
        openDropdown.classList.remove('show');
      }
    }
  }
}
</script>

<script type="text/javascript">
  var a = document.getElementById("selectMonth");
  a.value = "April";
</script>
    <script 
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCSXnflSrYaVxtCYuidN3TKs1P-2iwAtDk&libraries=visualization&callback=initMap">
    </script>

</body>
</html>

